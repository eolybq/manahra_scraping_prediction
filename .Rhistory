ni cen a objemu a cena_t-1 do "data"
load("data/ceny.RData")
load("data/ceny_t_1.RData")
load("data/objem.RData")
load("data/data.RData")
c_o_to_data <- function() {
walk(names(ceny[-1]), ~ {
data[data$podnik == ., "cena"] <<- ceny[[.]]
data[data$podnik == ., "objem_burza_t-1"] <<- volume[[.]]
data[data$podnik == ., "cena_t-1"] <<- ceny_t_1[[.]]
}
)
save(data, file = "data/data.RData")
rm(list = ls())
}
View(ceny)
View(ceny_t_1)
View(data)
c_o_to_data()
library(readxl)
library(readr)
library(tibble)
library(dplyr)
c_o_to_data()
library(purrr)
c_o_to_data()
library(purrr)
rm(list = ls())
# Scraping
# Zadat vždy burzovní kolo (Výysledky ze dne "".) do fce
source("./scraping.R")
save_price(1)
save_volume(1)
rm(list = ls())
load("data/ceny.RData")
load("data/ceny_t_1.RData")
load("data/objem.RData")
load("data/data.RData")
View(ceny)
View(ceny_t_1)
View(volume)
View(data)
walk(names(ceny[-1]), ~ {
data[data$podnik == ., "cena"] <<- ceny[[.]]
data[data$podnik == ., "objem_burza_t-1"] <<- volume[[.]]
data[data$podnik == ., "cena_t-1"] <<- ceny_t_1[[.]]
}
)
save(data, file = "data/data.RData")
rm(list = ls())
load("data/data.RData")
View(data)
load("data/objem.RData")
View(volume)
library(readxl)
library(readr)
library(tibble)
library(dplyr)
library(purrr)
# Scraping
# Zadat vždy burzovní kolo (Výysledky ze dne "".) do fce
source("./scraping.R")
save_price(2)
save_volume(2)
rm(list = ls())
load("data/ceny.RData")
load("data/ceny_t_1.RData")
load("data/objem.RData")
load("data/data.RData")
walk(names(ceny[-1]), ~ {
data[data$podnik == ., "cena"] <<- ceny[[.]]
data[data$podnik == ., "objem_burza_t-1"] <<- volume[[.]]
data[data$podnik == ., "cena_t-1"] <<- ceny_t_1[[.]]
}
)
save(data, file = "data/data.RData")
rm(list = ls())
load("data/data.RData")
View(data)
names(data)
ahoj <- names(data)
ahoj[-c(8, 7, 6)]
ahoj[c(6,7,8)] <- c("obch_jmeni_akcie_t-1", "HV_t-1", "neprodana_auta_t-1")
ahoj
names(data) <- ahoj
names(data)
data[, c("obch_jmeni_akcie_t-1", "hv_t-1")]
data[, c("obch_jmeni_akcie_t-1", "HV_t-1")]
data$`obch_jmeni_akcie_t-1` <- rep(NA_dbl, times=  1120)
data$`obch_jmeni_akcie_t-1` <- rep(NA_dbl_, times=  1120)
data$`obch_jmeni_akcie_t-1` <- rep(NA_real_, times=  1120)
data$`HV_t-1` <- rep(NA_real_, times=  1120)
save(data, file = "data/data.RData")
rm(list = ls())
library(readxl)
library(readr)
library(tibble)
library(dplyr)
library(purrr)
load("data/ceny.RData")
load("data/ceny_t_1.RData")
load("data/objem.RData")
load("data/data.RData")
vykazy_to_data <- function(kolo, vykazy_list) {
# Obch jmění
vlastni_kap_list <- map(vykazy_list, ~ unlist(.[.[[1]] == "Vlastní kapitál", ][-1]))
obch_jmeni_akcie <- map_dbl(c(vlastni_kap_list[[1]], vlastni_kap_list[[2]]), ~ as.numeric(.) * 1000 / 28e6)
data[data$kolo == (kolo + 1) & data$podnik %in% names(obch_jmeni_akcie), "obch_jmeni_akcie_t-1"] <- rep(obch_jmeni_akcie, each = 7)
# HV
hv_list <- map(vykazy_list, ~ unlist(.[.[[1]] == "HV celkem po zdanění", ][-1]))
hv <- map_dbl(c(hv_list[[1]], hv_list[[2]]), ~ as.numeric(.))
data[data$kolo == (kolo + 1) & data$podnik %in% names(hv), "HV_t-1"] <- rep(hv, each = 7)
return(data)
}
pridani_vykazu <- function(nove_vykazy, kolo) {
soubory <- dir("Výkazy/", pattern = "*.xlsx", full.names = TRUE)
data_list <- map(keep(soubory, ~. %in% nove_vykazy),
~ {
var <- read_excel(., n_max = 90)
var[-1]
})
vykazy_list <- map(data_list, na.omit)
vykazy_to_data(kolo, vykazy_list)
}
# Přidání nových výkazů /  Načtení výkazů do "data" (jednou za 1 kolo / 7 obch dnu)
# Vyměnit nazev souboru vykazu a kolo
data <- pridani_vykazu(c("Výkazy/23465.xlsx", "Výkazy/23466.xlsx"), 0)
save(data, file = "data/data.RData")
rm(list = ls())
load("data/data.RData")
dir_vysledky <- "Výsledky/"
if (!dir.exists(dir_vysledky)) {
dir.create(dir_vysledky)
}
View(data)
vysledky_url <- "http://manahra.cz/results/market/"
vysledky_page <- GET(vysledky_url, set_cookies(cookie_vector))
source("C:/Users/jezva/Desktop/R/Projekty/burza_predikce/scraping.R")
source("C:/Users/jezva/Desktop/R/Projekty/burza_predikce/scraping.R", echo=TRUE)
vysledky_url <- "http://manahra.cz/results/market/"
vysledky_page <- GET(vysledky_url, set_cookies(cookie_vector))
page_content_vys <- content(vysledky_page, "text")
page_vys <- read_html(page_content_vys)
links_vys <- page %>% html_nodes("a.ft_xls") %>% html_attr("href")
dir_vysledky <- "Výsledky/"
if (!dir.exists(dir_vysledky)) {
dir.create(dir_vysledky)
}
walk(links_vys, ~ {
file_name <- paste0(basename(.), ".xlsx")
file_path <- file.path(dir_vykazy, file_name)
tryCatch({
# Zkontroluj, zda soubor již existuje
if (!file.exists(file_path)) {
relative_link <- sub("^/", "", .)
full_link <- paste0(base_url, relative_link)
download_response <- GET(full_link, set_cookies(cookie_vector))
writeBin(content(download_response, "raw"), file_path)
cat("Stáhnuto:", file_name, "\n")
} else {
cat("Soubor již existuje, přeskočeno:", file_name, "\n")
}
}, error = function(e) {
cat("Chyba při stahování:", file_name, "\n", e$message, "\n")
})
})
vysledky_url <- "http://manahra.cz/results/market/"
vysledky_page <- GET(vysledky_url, set_cookies(cookie_vector))
page_content_vys <- content(vysledky_page, "text")
page_vys <- read_html(page_content_vys)
links_vys <- page %>% html_nodes("a.ft_xls") %>% html_attr("href")
dir_vysledky <- "Výsledky/"
if (!dir.exists(dir_vysledky)) {
dir.create(dir_vysledky)
}
walk(links_vys, ~ {
file_name <- paste0(basename(.), ".xlsx")
file_path <- file.path(dir_vysledky, file_name)
tryCatch({
# Zkontroluj, zda soubor již existuje
if (!file.exists(file_path)) {
relative_link <- sub("^/", "", .)
full_link <- paste0(base_url, relative_link)
download_response <- GET(full_link, set_cookies(cookie_vector))
writeBin(content(download_response, "raw"), file_path)
cat("Stáhnuto:", file_name, "\n")
} else {
cat("Soubor již existuje, přeskočeno:", file_name, "\n")
}
}, error = function(e) {
cat("Chyba při stahování:", file_name, "\n", e$message, "\n")
})
})
vysledky_url <- "http://manahra.cz/results/market/"
vysledky_page <- GET(vysledky_url, set_cookies(cookie_vector))
page_content_vys <- content(vysledky_page, "text")
page_vys <- read_html(page_content_vys)
links_vys <- page_vys %>% html_nodes("a.ft_xls") %>% html_attr("href")
dir_vysledky <- "Výsledky/"
if (!dir.exists(dir_vysledky)) {
dir.create(dir_vysledky)
}
walk(links_vys, ~ {
file_name <- paste0(basename(.), ".xlsx")
file_path <- file.path(dir_vysledky, file_name)
tryCatch({
# Zkontroluj, zda soubor již existuje
if (!file.exists(file_path)) {
relative_link <- sub("^/", "", .)
full_link <- paste0(base_url, relative_link)
download_response <- GET(full_link, set_cookies(cookie_vector))
writeBin(content(download_response, "raw"), file_path)
cat("Stáhnuto:", file_name, "\n")
} else {
cat("Soubor již existuje, přeskočeno:", file_name, "\n")
}
}, error = function(e) {
cat("Chyba při stahování:", file_name, "\n", e$message, "\n")
})
})
